package services

import java.io.InputStream
import java.net.URLEncoder

import jsonutils.JsonUtil
import play.api.libs.json._
import play.api.libs.json.Json._

import play.api.Logger
import play.api.libs.ws.WS.WSRequestHolder
import play.api.libs.ws._

import javax.inject.{Inject}
import scala.collection.immutable.List
import com.ning.http.client.Realm.AuthScheme

import scala.collection.JavaConversions._
import scala.concurrent.Await
import scala.concurrent.duration.Duration

/**
 * Service to get extraction logs from Graylog.
 */
class GraylogService @Inject() extends LogService {
  def getLog(extractorName: String, submissionID: Option[String]): List[String] = {
    val playConfig = play.Play.application().configuration()
    val serviceEndpoint = playConfig.getString("clowder.log.serviceEndpoint")
    val username = playConfig.getString("clowder.log.username")
    val password = playConfig.getString("clowder.log.password")
    val prefix = playConfig.getString("clowder.log.extractorNamePrefix")
    val query: String = "application_name:" + prefix + extractorName + "*"
    val queryEncode: String = URLEncoder.encode(query, "UTF-8")
    val queryUrl: String = serviceEndpoint + "/api/search/universal/relative?query=" + queryEncode
    Logger.debug(s"queryUrl - $queryUrl")
    var logs: List[String] = List()
    implicit val context = scala.concurrent.ExecutionContext.Implicits.global
    val result = WS.url(queryUrl)
      .withHeaders("X-Requested-By" -> "cli")
      .withHeaders("Accept" -> "application/json")
      .withHeaders("Content-Type" -> "application/json")
      .withAuth(username, password, AuthScheme.BASIC)
      .get().map{
      response => response.status match {
        case 200 => {
          val responseJson = Json.stringify(response.json)
          val responseJsonValue = JsonUtil.parseJSON(responseJson).asInstanceOf[java.util.LinkedHashMap[String, java.util.LinkedList[java.util.LinkedHashMap[String, String]]]]

          val raw: String = "{\n\t\"messages\": [{\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"343\",\n      \"gl2_accounted_message_size\": 348,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.172\",\n      \"gl2_remote_port\": 45132,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ6EMS9CTE7X1Q3TE4JH71HN\",\n      \"source\": \"7655c64956f5\",\n      \"message\": \"2020-09-14 14:00:05,674 [Thread-72      ] INFO    : pyclowder.connectors - [5f5f77648f08aa01dd4770f2] : StatusMessage.processing: Uploading file metadata.\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.1.irowe4759lbuoyl6r\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"979146c0-f692-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T14:00:05.000Z\"\n    },\n    \"index\": \"graylog_454\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"343\",\n      \"gl2_accounted_message_size\": 333,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.172\",\n      \"gl2_remote_port\": 45132,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ6EMSCKAYV39T6MYNSEFSB5\",\n      \"source\": \"7655c64956f5\",\n      \"message\": \"2020-09-14 14:00:05,778 [Thread-72      ] INFO    : pyclowder.connectors - [5f5f77648f08aa01dd4770f2] : StatusMessage.done: Done processing\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.1.irowe4759lbuoyl6r\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"97a0fe30-f692-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T14:00:05.000Z\"\n    },\n    \"index\": \"graylog_454\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"343\",\n      \"gl2_accounted_message_size\": 399,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.172\",\n      \"gl2_remote_port\": 45132,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ6EMS1WMR47D2QTQSYJ6JMX\",\n      \"source\": \"7655c64956f5\",\n      \"message\": \"2020-09-14 14:00:05,432 [Thread-72      ] DEBUG   : __main__ - sending request for digest streaming: https://dev.simpl.syngentadigitalapps.com/clowder/api/files/5f5f77648f08aa01dd4770f2/blob?key=FLzYnfJ6hl\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.1.irowe4759lbuoyl6r\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"976ca7c1-f692-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T14:00:05.000Z\"\n    },\n    \"index\": \"graylog_454\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 338,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 54032,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ67S3K73604YYA296KCV8S5\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 12:00:27,602 [Thread-72      ] INFO    : pyclowder.connectors - [5f5f5b468f08aa01dd476f39] : StatusMessage.start: Started processing\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"d4fbd770-f681-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T12:00:27.000Z\"\n    },\n    \"index\": \"graylog_454\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 349,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 54032,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ67S3TA40N7Q32135HDPHGZ\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 12:00:27,829 [Thread-72      ] INFO    : pyclowder.connectors - [5f5f5b468f08aa01dd476f39] : StatusMessage.processing: Uploading file metadata.\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"d51e7aa0-f681-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T12:00:27.000Z\"\n    },\n    \"index\": \"graylog_454\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 334,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 54032,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ67S3WHXBAGMSJR2VAB731K\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 12:00:27,900 [Thread-72      ] INFO    : pyclowder.connectors - [5f5f5b468f08aa01dd476f39] : StatusMessage.done: Done processing\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"d5295011-f681-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T12:00:27.000Z\"\n    },\n    \"index\": \"graylog_454\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 400,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 54032,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ67S3K7TAZAWWK4M5WPW7PZ\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 12:00:27,602 [Thread-72      ] DEBUG   : __main__ - sending request for digest streaming: https://dev.simpl.syngentadigitalapps.com/clowder/api/files/5f5f5b468f08aa01dd476f39/blob?key=FLzYnfJ6hl\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"d4fbd771-f681-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T12:00:27.000Z\"\n    },\n    \"index\": \"graylog_454\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"343\",\n      \"gl2_accounted_message_size\": 333,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.172\",\n      \"gl2_remote_port\": 35370,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ60XC4A8PGAW7N1QSZ5HGB7\",\n      \"source\": \"7655c64956f5\",\n      \"message\": \"2020-09-14 10:00:07,049 [Thread-71      ] INFO    : pyclowder.connectors - [5f5f3f258f08aa01dd476d80] : StatusMessage.done: Done processing\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.1.irowe4759lbuoyl6r\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"11514ea0-f671-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T10:00:07.000Z\"\n    },\n    \"index\": \"graylog_453\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"343\",\n      \"gl2_accounted_message_size\": 348,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.172\",\n      \"gl2_remote_port\": 35370,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ60XC0S4N247THD0XHBHNVT\",\n      \"source\": \"7655c64956f5\",\n      \"message\": \"2020-09-14 10:00:06,935 [Thread-71      ] INFO    : pyclowder.connectors - [5f5f3f258f08aa01dd476d80] : StatusMessage.processing: Uploading file metadata.\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.1.irowe4759lbuoyl6r\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"11401090-f671-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T10:00:06.000Z\"\n    },\n    \"index\": \"graylog_453\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"343\",\n      \"gl2_accounted_message_size\": 399,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.172\",\n      \"gl2_remote_port\": 35370,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ60XBNCGCK7FMKA015042D3\",\n      \"source\": \"7655c64956f5\",\n      \"message\": \"2020-09-14 10:00:06,569 [Thread-71      ] DEBUG   : __main__ - sending request for digest streaming: https://dev.simpl.syngentadigitalapps.com/clowder/api/files/5f5f3f258f08aa01dd476d80/blob?key=FLzYnfJ6hl\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.1.irowe4759lbuoyl6r\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"11085ec0-f671-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T10:00:06.000Z\"\n    },\n    \"index\": \"graylog_453\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 349,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 41780,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ5T1MKJMQ8YV4X8NVZJ0CZZ\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 08:00:27,098 [Thread-71      ] INFO    : pyclowder.connectors - [5f5f23058f08aa01dd476bc7] : StatusMessage.processing: Uploading file metadata.\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"4d9dc520-f660-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T08:00:27.000Z\"\n    },\n    \"index\": \"graylog_453\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 334,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 41780,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ5T1MPZEG2S4SFZE6C5KYSR\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 08:00:27,208 [Thread-71      ] INFO    : pyclowder.connectors - [5f5f23058f08aa01dd476bc7] : StatusMessage.done: Done processing\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"4dae66f0-f660-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T08:00:27.000Z\"\n    },\n    \"index\": \"graylog_453\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 400,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 41780,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ5T1MA310VZW9M7YC0SD6GE\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 08:00:26,796 [Thread-71      ] DEBUG   : __main__ - sending request for digest streaming: https://dev.simpl.syngentadigitalapps.com/clowder/api/files/5f5f23058f08aa01dd476bc7/blob?key=FLzYnfJ6hl\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"4d6f8930-f660-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T08:00:26.000Z\"\n    },\n    \"index\": \"graylog_452\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 338,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 41780,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ5T1MA3QAPCDJZM45BCBNGQ\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 08:00:26,796 [Thread-71      ] INFO    : pyclowder.connectors - [5f5f23058f08aa01dd476bc7] : StatusMessage.start: Started processing\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"4d6f8931-f660-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T08:00:26.000Z\"\n    },\n    \"index\": \"graylog_452\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"343\",\n      \"gl2_accounted_message_size\": 399,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.172\",\n      \"gl2_remote_port\": 53816,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ5K5XP3DDVYDSCX5EC2340Q\",\n      \"source\": \"7655c64956f5\",\n      \"message\": \"2020-09-14 06:00:07,103 [Thread-70      ] DEBUG   : __main__ - sending request for digest streaming: https://dev.simpl.syngentadigitalapps.com/clowder/api/files/5f5f06e68f08aa01dd476a0e/blob?key=FLzYnfJ6hl\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.1.irowe4759lbuoyl6r\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"8a486130-f64f-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T06:00:07.000Z\"\n    },\n    \"index\": \"graylog_452\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"343\",\n      \"gl2_accounted_message_size\": 333,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.172\",\n      \"gl2_remote_port\": 53816,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ5K5Y2RR8Z4NEZ7BPCRWEHS\",\n      \"source\": \"7655c64956f5\",\n      \"message\": \"2020-09-14 06:00:07,510 [Thread-70      ] INFO    : pyclowder.connectors - [5f5f06e68f08aa01dd476a0e] : StatusMessage.done: Done processing\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.1.irowe4759lbuoyl6r\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"8a860671-f64f-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T06:00:07.000Z\"\n    },\n    \"index\": \"graylog_452\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"343\",\n      \"gl2_accounted_message_size\": 348,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.172\",\n      \"gl2_remote_port\": 53816,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ5K5XZ58T925AW1AZQYGFGS\",\n      \"source\": \"7655c64956f5\",\n      \"message\": \"2020-09-14 06:00:07,395 [Thread-70      ] INFO    : pyclowder.connectors - [5f5f06e68f08aa01dd476a0e] : StatusMessage.processing: Uploading file metadata.\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.1.irowe4759lbuoyl6r\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"8a74a150-f64f-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T06:00:07.000Z\"\n    },\n    \"index\": \"graylog_452\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 334,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 57402,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ5CA7PCQ0XD7NYD46T28QRC\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 04:00:28,722 [Thread-70      ] INFO    : pyclowder.connectors - [5f5eeac78f08aa01dd476855] : StatusMessage.done: Done processing\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"c78440c0-f63e-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T04:00:28.000Z\"\n    },\n    \"index\": \"graylog_452\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 400,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 57402,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ5CA7AQBGCKX8PHG66PDR2V\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 04:00:28,349 [Thread-70      ] DEBUG   : __main__ - sending request for digest streaming: https://dev.simpl.syngentadigitalapps.com/clowder/api/files/5f5eeac78f08aa01dd476855/blob?key=FLzYnfJ6hl\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"c74b5670-f63e-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T04:00:28.000Z\"\n    },\n    \"index\": \"graylog_452\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 349,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 57402,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ5CA7JA3CAQV7KJE4CXADSN\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 04:00:28,592 [Thread-70      ] INFO    : pyclowder.connectors - [5f5eeac78f08aa01dd476855] : StatusMessage.processing: Uploading file metadata.\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"c7706aa0-f63e-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T04:00:28.000Z\"\n    },\n    \"index\": \"graylog_452\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 338,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 57402,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ5CA7AQT8JNDM4CE6AY1FYK\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 04:00:28,349 [Thread-70      ] INFO    : pyclowder.connectors - [5f5eeac78f08aa01dd476855] : StatusMessage.start: Started processing\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"c74b5671-f63e-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T04:00:28.000Z\"\n    },\n    \"index\": \"graylog_452\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"343\",\n      \"gl2_accounted_message_size\": 399,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.172\",\n      \"gl2_remote_port\": 43906,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ55EERP0WK4BY0F8BNH6Y1T\",\n      \"source\": \"7655c64956f5\",\n      \"message\": \"2020-09-14 02:00:06,674 [Thread-69      ] DEBUG   : __main__ - sending request for digest streaming: https://dev.simpl.syngentadigitalapps.com/clowder/api/files/5f5ecea68f08aa01dd47669d/blob?key=FLzYnfJ6hl\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.1.irowe4759lbuoyl6r\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"02f54b61-f62e-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T02:00:06.000Z\"\n    },\n    \"index\": \"graylog_451\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"343\",\n      \"gl2_accounted_message_size\": 348,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.172\",\n      \"gl2_remote_port\": 43906,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ55EF01RNZQ585D1TC82TWZ\",\n      \"source\": \"7655c64956f5\",\n      \"message\": \"2020-09-14 02:00:06,911 [Thread-69      ] INFO    : pyclowder.connectors - [5f5ecea68f08aa01dd47669d] : StatusMessage.processing: Uploading file metadata.\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.1.irowe4759lbuoyl6r\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"03192710-f62e-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T02:00:06.000Z\"\n    },\n    \"index\": \"graylog_451\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"343\",\n      \"gl2_accounted_message_size\": 333,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.172\",\n      \"gl2_remote_port\": 43906,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ55EF2RXF7FX5NS0XCWRHZD\",\n      \"source\": \"7655c64956f5\",\n      \"message\": \"2020-09-14 02:00:06,999 [Thread-69      ] INFO    : pyclowder.connectors - [5f5ecea68f08aa01dd47669d] : StatusMessage.done: Done processing\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.1.irowe4759lbuoyl6r\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"03266d80-f62e-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T02:00:06.000Z\"\n    },\n    \"index\": \"graylog_451\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 349,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 45380,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ4YJRA9SJGT1AW0VMHA8C44\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 00:00:27,823 [Thread-69      ] INFO    : pyclowder.connectors - [5f5eb2868f08aa01dd4764e4] : StatusMessage.processing: Uploading file metadata.\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"3fe97390-f61d-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T00:00:27.000Z\"\n    },\n    \"index\": \"graylog_451\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 334,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 45380,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ4YJRCMRVVXBZPWXMBJXYQM\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 00:00:27,897 [Thread-69      ] INFO    : pyclowder.connectors - [5f5eb2868f08aa01dd4764e4] : StatusMessage.done: Done processing\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"3ff4e540-f61d-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T00:00:27.000Z\"\n    },\n    \"index\": \"graylog_451\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 338,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 45380,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ4YJQZPE3ST9C6VF22RVM9D\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 00:00:27,484 [Thread-69      ] INFO    : pyclowder.connectors - [5f5eb2868f08aa01dd4764e4] : StatusMessage.start: Started processing\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"3fb5b962-f61d-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T00:00:27.000Z\"\n    },\n    \"index\": \"graylog_451\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 400,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 45380,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ4YJQZQ2979DAS37ZEYK2VA\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-14 00:00:27,485 [Thread-69      ] DEBUG   : __main__ - sending request for digest streaming: https://dev.simpl.syngentadigitalapps.com/clowder/api/files/5f5eb2868f08aa01dd4764e4/blob?key=FLzYnfJ6hl\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"3fb5b963-f61d-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-14T00:00:27.000Z\"\n    },\n    \"index\": \"graylog_451\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"343\",\n      \"gl2_accounted_message_size\": 348,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.172\",\n      \"gl2_remote_port\": 34370,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ4QQ0S3NQ074D8SC7S9YPXR\",\n      \"source\": \"7655c64956f5\",\n      \"message\": \"2020-09-13 22:00:07,201 [Thread-68      ] INFO    : pyclowder.connectors - [5f5e96668f08aa01dd47632b] : StatusMessage.processing: Uploading file metadata.\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.1.irowe4759lbuoyl6r\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"7c33c730-f60c-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-13T22:00:07.000Z\"\n    },\n    \"index\": \"graylog_450\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"343\",\n      \"gl2_accounted_message_size\": 333,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.172\",\n      \"gl2_remote_port\": 34370,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ4QQ0VEF9VA8ZR3A9630ZCK\",\n      \"source\": \"7655c64956f5\",\n      \"message\": \"2020-09-13 22:00:07,277 [Thread-68      ] INFO    : pyclowder.connectors - [5f5e96668f08aa01dd47632b] : StatusMessage.done: Done processing\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.1.irowe4759lbuoyl6r\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"7c3f38e1-f60c-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-13T22:00:07.000Z\"\n    },\n    \"index\": \"graylog_450\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"343\",\n      \"gl2_accounted_message_size\": 399,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.172\",\n      \"gl2_remote_port\": 34370,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ4QQ0JSZ8T3HBBSF3KVJ9GV\",\n      \"source\": \"7655c64956f5\",\n      \"message\": \"2020-09-13 22:00:06,998 [Thread-68      ] DEBUG   : __main__ - sending request for digest streaming: https://dev.simpl.syngentadigitalapps.com/clowder/api/files/5f5e96668f08aa01dd47632b/blob?key=FLzYnfJ6hl\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.1.irowe4759lbuoyl6r\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"7c14f490-f60c-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-13T22:00:06.000Z\"\n    },\n    \"index\": \"graylog_450\",\n    \"decoration_stats\": null\n  }, {\n    \"highlight_ranges\": {},\n    \"message\": {\n      \"process_id\": \"5822\",\n      \"gl2_accounted_message_size\": 338,\n      \"level\": 3,\n      \"gl2_remote_ip\": \"10.0.10.241\",\n      \"gl2_remote_port\": 33366,\n      \"streams\": [\"000000000000000000000001\"],\n      \"gl2_message_id\": \"01EJ4GV93STR68E7FRCRM7Q1A5\",\n      \"source\": \"b6ae36cb3653\",\n      \"message\": \"2020-09-13 20:00:27,105 [Thread-68      ] INFO    : pyclowder.connectors - [5f5e7a458f08aa01dd476172] : StatusMessage.start: Started processing\",\n      \"gl2_source_input\": \"5f2d6cbdfe6eb70769683d1c\",\n      \"application_name\": \"clowder-dev_ncsa_file_digest.2.s6i35ypkuyzau2pr8\",\n      \"gl2_source_node\": \"f1971377-bf1a-4d91-a30b-f784a03946bb\",\n      \"_id\": \"b869f690-f5fb-11ea-9775-0242ac120006\",\n      \"facility\": \"user-level\",\n      \"timestamp\": \"2020-09-13T20:00:27.000Z\"\n    },\n    \"index\": \"graylog_450\",\n    \"decoration_stats\": null\n  }]\n}"
          val rawjsonValue = JsonUtil.parseJSON(raw).asInstanceOf[java.util.LinkedHashMap[String, java.util.LinkedList[java.util.LinkedHashMap[String, String]]]]
          val messagesjsonValue = rawjsonValue.get("messages")

//          val messagesjsonValue = responseJsonValue.get("messages")
          messagesjsonValue.foreach(elem => {
            val elemMap = elem.asInstanceOf[java.util.HashMap[String, java.util.HashMap[String, String]]]
            val message: String = elemMap.get("message").get("message")
            val keyIndex: Int = message.indexOf("key=")
            keyIndex match {
              case -1 => {
                logs = logs :+ message
              }
              case _  => {
                val filterMessage: String = message.substring(0, keyIndex)
                logs = logs :+ filterMessage
              }
            }
          }
          )
        }
        case _ => {
          val status = response.status
          Logger.warn(s"Problem accessing api, status '$status'")
        }
      }
    }

    Await.result(result, Duration.Inf)
    return logs
  }
}