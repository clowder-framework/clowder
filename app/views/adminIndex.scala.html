@(theme: Int, appAppearance: models.AppAppearance)(implicit user: Option[securesocial.core.Identity])
@main("Administration") {
	<div class="page-header">
		<h1>Index Administration</h1>
	</div>	
		
	<legend>Create an Index</legend>
	
	<div class="container-fluid">        
      <div class="row">      
       <div class="col-md-12">
       
       	<!----------------------------------------------->
		<!------    Choose a name for index   ------>
       	<!----------------------------------------------->				
       <div class="col-md-3" style="margin-right:5px;">
		 		<h5>Choose a Name for Index (optional)</h5>
				<input type="text" id="nameTextArea" onchange="setNameForIndex()">						
		</div> 
			
			<div class="col-md-3">	  
       			<h5>Choose file type</h5>
					<select id="fileTypeDropDown" onchange="setFileTypeAndAvailableAdapters()">
					<option value="invalid">--File Type--</option>					
					<option value="image">Image</option>
					<option value="jpeg">Image-jpeg</option>
					<option value="png">Image-png</option>
					<option value="pdf">PDF</option>
					<option value="doc">Doc</option>
					<option value="rtf">RTF</option>
					<option value="sectionCensus">Section of Census Image</option>
					<option value="sectionFace">Face extractor section</option>
					</select>
			</div>
					       
			<div class="col-md-3">
				<h5>Choose an Adapter</h5>
				<select id="adapterDropDown" onchange="setAdapterTypeAndAvailableExtractors()">
					<option value="invalid">--Adapter--</option>
				</select>
				
				<div style="text-align: left;">			
				<!------------------------------------->
				<!------    Create new index     ------>
				<!------------------------------------->
      			 <input id="create" type="submit" class="btn btn-default btn-sm" value="Create" />
      			 </div>    			 
      			 
      			 <br>
      			 <br>
      			 <!--- placeholder for feedback message -->
      			 <div id="createIndexFeedback"style="text-align: right;">
      			 </div>				
			</div>		
				
		<div class="col-md-3">	
			<h5>Choose an Extractor</h5>
				<select id="extractorDropDown" onchange="setExtractorTypeAndAvailableMeasures()">
					<option value="invalid">--Extractor--</option>
				</select>	
	 		</div>
	 		
	 		<div class="col-md-3" style="margin-right:5px;">
				<h5>Choose a Measure</h5>
				<select id="measureDropDown" onchange="setMeasureType()">
					<option value="invalid">--Measure--</option>
				</select>				
			</div>
						
			
			<div class="col-md-3">
				<h5>Choose an Indexer </h5>
				<select id="indexerDropDown" onchange="setIndexerState()">
					<option value="invalid">--Indexer--</option>
				</select>				
			</div>
			
  		</div>
	</div>
</div>
<br>
<br>

 

<br>
<br>
<!------------------------------------->
<!------    Build an index       ------>
<!------------------------------------->
<legend> Build an Index</legend>
<div class="row">
	   <div class="col-md-12">
	   	<div class="col-md-3">
				<h5>Choose an Index </h5>
				<select id="indexDropDownList" onchange="setIndexState()">
					<option value="invalid">--Index--</option>
				</select>
				<div style="text-align: left;">
				<input id="build" class="btn btn-default btn-sm" type="submit" value="Build Index">
				</div>
				<div id="buildmsg"style="text-align: left;">
      					<!-- Placeholder for build results message -->
      			 </div>
		</div>		
	</div>	
</div>

<br>
<br>

<!------------------------------------->
<!------    List all indexes     ------>
<!------------------------------------->
<legend> List All Indexes</legend>
<div class="row">
<div class="col-md-12">
	   <div style="text-align: left;">			
       <input id="list" type="submit" class="btn btn-default btn-sm" value="List All Indexes" />
       </div>
       <div id="listIndexesTable">
          <!-- Placeholder for table with info about indexes -->       
       </div>
    </div>
</div>
<br>
<br>


<!------------------------------------->
<!------    Delete one index     ------>
<!------------------------------------->
<legend> Delete an Index</legend>
<div class="row">
	   <div class="col-md-12">
	   	<div class="col-md-3">
				<h5>Choose an Index </h5>
				<select id="indexDel" onchange="setIndexDelState()">
					<option value="invalid">--Index--</option>
				</select>
				<div style="text-align: left;">
				<input id="delete" class="btn btn-default btn-sm" type="submit" value="Delete Index">
				</div>
				<br>
				<br>
				<div id="deletemsg" style="text-align: left;">
					<!-- Placeholder for message with results of delete index -->
      			 </div>
		</div>		
	</div>
</div>
<br>

<!------------------------------------->
<!------    Delete all indexes   ------>
<!------------------------------------->
<legend> Delete All Indexes</legend>
<div class="row">
<div class="col-md-12">
	   <div style="text-align: left;">			
       <input id="deleteAll" type="submit" class="btn btn-default btn-sm btn-danger" value="Delete All" />
       </div>
         <div id="deleteallmsg" style="text-align: left;">
         	  <!-- Placeholder for message with results of delete ALL indexes -->         
      </div>
   </div>  
</div>
	


<script language="javascript">

var fileTypeList = [];
var fileTypeState = false;
var fileTypeSelected;

var isCensusIndex = false;
var isFaceIndex = false;

var indexName="";

var allAdapterList=[];
var shortAdapterList=[];

var allExtractorList=[];
var shortExtractorList=[];

var allMeasureList=[];
var shortMeasureList=[];

var adapterState= false;
var extractorState=false;
var measureState= false;

var adapterSelected;
var extractorSelected;
var measureSelected;

var indexerState=false;
var indexState=false;
var indexerSelected;
var indexSelected="";

var indexerList=[];
var indexList=[];

$(document).ready(function (){
	getAllAdapters();//global car adapterList is now set
	getAllExtractors();//global var allExtractorList is now set
	getAllMeasures();//global  allMeasureList is now set
	getIndexers();//global  indexerList is now set
	getIndexes();//global  indexerList is now set
	
});


function setNameForIndex(){
	indexName = nameTextArea.value
	console.log("inside setNameForIndex = " + indexName)	
}



//Called when page is loaded
function getAllAdapters() {
$.ajax({
            type : "GET",
            url : "@routes.Admin.getAdapters()",
            dataType : "json",
            
            success : function(json) {            	             
            	var mimeTypes = "";	
            	for(var i=0; i<json.length; i++){
            		mimeTypes = json[i].supportedMimeTypes;		
            		console.log('. ');	
            		allAdapterList.push({name:json[i].name,id:json[i].id,mimeTypes:json[i].supportedMimeTypes, interfaces:json[i].interfaces});			
            	}	
            },
            
            error : function(xhr, textStatus, errorThrown) {
                console.log('Make call failed - getAllAdapters ' +  errorThrown);
            }
        });          
}

//Called when page is loaded
function getAllExtractors() {
		$.ajax({
            type: 'GET',
            url: "@routes.Admin.getExtractors()",            
            dataType: "json",
            
            success: function(data) {
            	console.log("=======setAllExtractorList - top"); 	
            	for(var i=0; i<data.length; i++){
            		allExtractorList.push({name:data[i].name, 
            									id:data[i].id, 
            									supportedFeature:data[i].supportedFeature, 
            									supportedAdapters:data[i].supportedAdapters});					
            	}
            	console.log("=======setAllExtractorList - bottom");                
            },
            
            error: function(xhr, textStatus, errorThrown) {
                console.log('Make call failed - getAllExtractors' +  errorThrown);
            }
        });
}


	

//Called when page is loaded
function getAllMeasures() {
$.ajax({
            type : 'GET',
            url : "@routes.Admin.getMeasures()",
            dataType : "json",
            success : function(data) {          
                setAllMeasureList(data);
            },
            error : function(xhr, textStatus, errorThrown) {
                console.log('Make call failed - getMeasures' +  errorThrown);
            }
        });	
}

function setAllMeasureList(json){
	console.log("=======setAllMeasureList - top");
	for(var i=0; i<json.length; i++){
			console.log(". ");
			allMeasureList.push({name:json[i].name,id:json[i].id,supportedFeatureType:json[i].supportedFeatureType});
	}
	console.log("=======setAllMeasureList - bottom");
}

//Called when page is loaded
function getIndexers() {
$.ajax({
            type : 'GET',
            url : "@routes.Admin.getIndexers()",
            dataType : "json",
            success : function(data) {
            	console.log('Call succeeded');
                setIndexerList(data);
            },
            error : function(xhr, textStatus, errorThrown) {
                console.log('Make call failed -getIndexers ' +  errorThrown);
            }
        });	
}

function setIndexerList(json){
	var availableIndexers = "";
	for(var i=0; i<json.length; i++){
		availableIndexers = availableIndexers+'<option value="'+json[i].id+'" >'+json[i].name+'</option>';
	    indexerList[i] = {name:json[i].name,id:json[i].id};
	}
	$("#indexerDropDown").html('<option value="invalid">--Indexer--</option>'+availableIndexers);
}

/*
* Called when page is loaded
* will set indexDropDownList and indexDel variables
*/
function getIndexes() {
	console.log('from getIndexes');
	$.ajax({
            type : 'GET',
            url : "@routes.Admin.getIndexes()",
            dataType : "json",
            success : function(data) {
            	console.log(' Admin.getIndexes - Call succeeded ');                
                setIndexList(data);
            },
            error : function(xhr, textStatus, errorThrown) {
                console.log('Admin.getIndexes - Make call failed ' +  errorThrown);
            }
        });	
}

function setIndexList(json){	
	console.log("===setIndexList - will update indexDropDownList");
	var availableIndexes = "";
	for(var i=0; i<json.length; i++){	
		console.log("available index id = " +json[i].indexID );
		availableIndexes = availableIndexes+'<option value="'+json[i].indexID+'" >'+json[i].indexID+'</option>';
		indexList[i] = {indexID:json[i].indexID,MIMEtype:json[i].MIMEtype,Extractor:json[i].Extractor, Measure:json[i].Measure,Indexer:json[i].Indexer};
	}
	$("#indexDropDownList").html('<option value="invalid">--Index--</option>'+availableIndexes);
	$("#indexDel").html('<option value="invalid">--Index--</option>'+availableIndexes);
}

/*
 * Called when a file type is selected from drop down list
 */
function setFileTypeAndAvailableAdapters(){
	console.log("=======setFileTypeAndAvailableAdapters - top");
	//
	//started creating a new index - first reset everything
	//
	document.getElementById("createIndexFeedback").innerHTML = "";
	//$('#createIndexFeedback').text( "Hello");
	adapterSelected=null;
	extractorSelected=null;
	measureSelected=null;
	indexerSelected=null;
	
	$("#extractorDropDown").html('<option value="invalid">--Extractor--</option>');	
	$("#measureDropDown").html('<option value="invalid">--Measure--</option>');
	document.getElementById("indexerDropDown").selectedIndex = 0;
	
	//$("#indexerDropDown").val()="invalid";	
	//
	//process new file type
	//
	if($("#fileTypeDropDown").val() == "invalid"){
		fileTypeState = false;
	}
	else{
		fileTypeState    = true;
		fileTypeSelected =  $("#fileTypeDropDown").val();
	
		//set global var isCensusIndex
		//if census index then set the global variable, and then process as regular image.
  		if (fileTypeSelected == "sectionCensus"){
       		 isCensusIndex = true;  
       		 indexType = "censusIndex"
       		 fileTypeSelected = "image"
       	} else if (fileTypeSelected == "sectionFace"){
       		 isFaceIndex = true;
       		 indexType = "faceIndex"
       		 fileTypeSelected = "image"
       	}   else {
       		isCensusIndex=false;
      		 isFaceIndex = false;   
      		indexType=""
       	} 
  		
		setShortAdapterList(fileTypeSelected);
	}	
}

/*
 * Create and set list of adapters that can process the given type of file.
 */
function setShortAdapterList(type)
{
	console.log("=======setShortAdapterList - top - type = " + type);	
	var availableAdapters="";	
		for(var i=0; i<allAdapterList.length; i++){
			var mimeTypes = allAdapterList[i].mimeTypes;					
			var bool = false;
			for (var j=0; j< mimeTypes.length; j++){
				if (mimeTypes[j].indexOf(type) != -1){
					bool = true;
				}
			}		
			if (bool) {			
				availableAdapters  = availableAdapters+'<option value="'+allAdapterList[i].id+'" >'+allAdapterList[i].name+'</option>';			
				shortAdapterList.push(allAdapterList[i]);	
			}			
		}	
	$("#adapterDropDown").html('<option value="invalid">--Adapter--</option>'+availableAdapters);
}



/*
 * Called once selected an adapter from drop down list.
 * For selected adapter, will set adapterSelected variable and list of adapter interfaces
 */
function setAdapterTypeAndAvailableExtractors(){
	console.log("==adapter drop down on change: from set adapter state")	
	var adapterInterfaces =[];	
	if($("#adapterDropDown").val() == "invalid"){
		adapterState = false;$("#extractorDropDown").html('<option value="invalid">--Extractor--</option>'+availableExtractors);
	} else{
		adapterState    = true;
		for( var i=0; i<shortAdapterList.length; i++){
			if($("#adapterDropDown").val() == shortAdapterList[i].id ){				
				adapterInterfaces = shortAdapterList[i].interfaces;
				adapterSelected=shortAdapterList[i].id.split(" ")[1];
			}
		}		
		setShortExtractorList(adapterInterfaces);
	}
}

/*
 * Finds extractors that match given array of interfaces. 
 * For selected adapter, will display all matching extractors.
 */
function setShortExtractorList(interfacesArray){
	console.log("=======top of setShortExtractorList");	
	//interfaces that this adapter is extending
	//var interfacesArray = adapter.interfaces;
	var availableExtractors ="";
	for(var i=0; i<allExtractorList.length; i++){		
		var supportedAdaptersArray = allExtractorList[i].supportedAdapters;

		//need to find intersection of two arrays - interfaces and supportedAdapters.
		//if intersection is not emptsupported adapters =y then this extractor supports this adapter.
		
		//for i's extractor, go through all the interfaces that adapter is extending and find 
		//which of these interfaces the extractor supports.
		var results = [];
		for (var k = 0; k < interfacesArray.length; k++) {
    		if (supportedAdaptersArray.indexOf(interfacesArray[k]) !== -1) {
    			//console.log("found intersection " + interfacesArray[k]);
        		results.push(interfacesArray[k]);
    		}
		}
		
		if (results.length ==0){
			console.log("+++no intersection found => no extactors for this adapter found.");
		} else {
			//intersection is non empty => this extractor supports this adapter, so add it to the short list.
			availableExtractors  = availableExtractors+'<option value="'+allExtractorList[i].id+'" >'+allExtractorList[i].name+'</option>';			
			shortExtractorList.push(allExtractorList[i]);
		}		
	}
	$("#extractorDropDown").html('<option value="invalid">--Extractor--</option>'+availableExtractors);
}

/*
 * Called when an extractor is selected from drop down list.
 */
function setExtractorTypeAndAvailableMeasures(){
	var supportedFeature;	
	if($("#extractorDropDown").val() == "invalid"){
		extractorState = false;
	} else {
		extractorState    = true;
		for( var i=0; i<shortExtractorList.length; i++){
			if($("#extractorDropDown").val() == shortExtractorList[i].id ){
				//console.log("extractorList",$("#extractorDropDown").val());
				console.log("Extractor name selected",shortExtractorList[i].name,"shortExtractorList[i].id=",shortExtractorList[i].id);
				supportedFeature = shortExtractorList[i].supportedFeature;
				extractorSelected=shortExtractorList[i].id.split(" ")[1];
			}
		}
		setShortMeasureList(supportedFeature);
	}
	//toggleSubmitButton();
}

/*
 * List of measures that match given feature type
 */
function setShortMeasureList(featureType)
{
	console.log('====== setting short measures list for featureType ' + featureType );
	
	var availableMeasures="";
	for(var i=0; i<allMeasureList.length; i++){
		var featureTypes = allMeasureList[i].supportedFeatureType;
		//go through list of all features this measure supports
		//console.log ("feature types = " + featureTypes);
		var bool = false; 		
		for (var j=0; j<featureTypes.length; j++){
		if (featureTypes[j].indexOf(featureType) != -1){
				bool = true;
			}		
		}		
		if (bool) {			
			availableMeasures  = availableMeasures+'<option value="'+allMeasureList[i].id+'" >'+allMeasureList[i].name+'</option>';	
			shortMeasureList.push(allMeasureList[i]);	
		}			
	}		
	$("#measureDropDown").html('<option value="invalid">--Measure--</option>'+availableMeasures);
}



/*
 * Called when a measure is selected from drop down list
 */
function setMeasureType(){
	console.log("=====top of setMeasureType()");
	if($("#measureDropDown").val() == "invalid"){
		console.log("measure not selected");
		measureState = false;
	} else{
		console.log("measure is selected, val = " + $("#measureDropDown").val());
		measureState    = true;
		for( var i=0; i<shortMeasureList.length; i++){
			//console.log("shortMeasureList[i].id = " + shortMeasureList[i].id);
			if($("#measureDropDown").val() == shortMeasureList[i].id ){
				//console.log("shortMeasureList",$("#measureDropDown").val());
				console.log("Measure name selected: ",shortMeasureList[i].name," shortMeasureList[i].id=",shortMeasureList[i].id);
				measureSelected=shortMeasureList[i].id.split(" ")[1];
				console.log("-=-=measureSelected = " + measureSelected);
			}
		}
	}
	//toggleSubmitButton();
}


function setIndexerState(){
	if($("#indexerDropDown").val() == "invalid"){
		indexerState = false;
	}
	else{
		indexerState    = true;
		for( var i=0; i<indexerList.length; i++){
			if($("#indexerDropDown").val() == indexerList[i].id ){
				console.log("indexerList",$("#indexerDropDown").val());
				console.log("Indexer name selected: ",indexerList[i].name," indexerList[i].id=",indexerList[i].id);
				//measureSupportedFeatureType = measureList[i].supportedFeatureType;
				indexerSelected=indexerList[i].id;
			}
		}
		console.log(indexerSelected);
	}
}



function setIndexState(){
	if($("#indexDropDownList").val() == "invalid"){
		indexState = false;
	}
	else{
		indexState    = true;
		for( var i=0; i<indexList.length; i++){
			if($("#indexDropDownList").val() == indexList[i].indexID ){
				console.log("indexList",$("#indexDropDownList").val());
				console.log("Index name selected: ",indexList[i].indexID);				
				indexSelected=indexList[i].indexID;
			}
		}		
		console.log("indexSelected=",indexSelected);
	}	
}

function setIndexDelState(){
	if($("#indexDel").val() == "invalid"){
		indexState = false;
	}
	else{
		indexState    = true;
		for( var i=0; i<indexList.length; i++){
			if($("#indexDel").val() == indexList[i].indexID ){
				console.log("indexList",$("#indexDel").val());
				console.log("Index name selected: ",indexList[i].indexID);				
				indexSelected=indexList[i].indexID;
			}
		}		
		console.log("indexSelected=",indexSelected);
	}	
}


var createBtn=document.getElementById('create');
    createBtn.onclick=function(evt){
    console.log("========Inside createBtn onclick function");
      	$.ajax({
            type : 'POST',
            url : "@routes.Admin.createIndex()",
            contentType: "application/json",
            data:JSON.stringify({"name":indexName, "adapter":adapterSelected, "extractor":extractorSelected, "measure":measureSelected, "indexer":indexerSelected,"indexType":indexType}),
           
            success : function(data1) {            
                console.log("data1:", data1);
                console.log("Sucessfully created");
              	//update list of indexes everywhere on the page
    	    	getIndexes();
    			//remove old info messages
    	        resetDisplay();
                //display info message for create index
                $('#createIndexFeedback').text( data1);              	
            },
            error : function(xhr, textStatus, errorThrown) {
                console.log('Make call failed ' +  errorThrown);
                $('#createIndexFeedback').text( "Index could not be created");
            }
        });      	
}	    
    			
    
    
var buildBtn=document.getElementById('build');
    buildBtn.onclick=function(evt){    
    	console.log("========Inside buildBtn onclick function, index = ", indexSelected);    
    	var request=jsRoutes.controllers.Admin.buildIndex(indexSelected).ajax({
   					 type:'POST'
    	});
    	request.done(function (response, textStatus, jqXHR){
					//remove old info messages
	                resetDisplay();
    				$('#buildmsg').text(response);
    	});
}	
        
    	
var listBtn=document.getElementById('list');
    listBtn.onclick=function(evt){    
        console.log("========Inside listBtn onclick function");
    	var request=jsRoutes.controllers.Admin.getIndexes().ajax({
   					 type:'GET',
   					 dataType: "json",
    				});
    				request.done(function (json, textStatus, jqXHR){
						console.log("Response =" + json);
						//remove old info messages
    	                resetDisplay();
						
						var tab=[];
						if (json.length>0){
						tab.push('<table id="inputTable" class="table table-bordered table-striped" style="display:inline;"><th>Name of Index</th><th>Type of Index</th><th>IndexId</th><th>Extractor</th><th>Measure</th><th>Indexer</th>');
                        
						for(var i=0; i<json.length; i++){						
								indexList[i] = {indexID:json[i].indexID,MIMEtype:json[i].MIMEtype,Extractor:json[i].Extractor, Measure:json[i].Measure,Indexer:json[i].Indexer};
									tab.push('<tr id=i >',
							      	'<td>',  json[i].indexName, '</td>',
							      	'<td>',  json[i].indexType, '</td>',
							    	'<td>', json[i].indexID, '</td>',
							      	'<td>',json[i].Extractor,' </td>',
							      	'<td>',json[i].Measure,'</td>',
							      	'<td>',json[i].Indexer,'</td>',
							      	'</tr>');							
							}
						tab.push('</table>');
						document.getElementById('listIndexesTable').innerHTML=tab.join('');		
						}
						if (json.length==0){						
							document.getElementById('listIndexesTable').innerHTML="No indexes found";	
						}						
   					 });
    	    }		


    var deleteBtn=document.getElementById('delete');
    deleteBtn.onclick=function(evt){ 
        console.log("========Inside deleteBtn onclick function");
    	var request=jsRoutes.controllers.Admin.deleteIndex(indexSelected).ajax({
   					 type:'DELETE'
    				});
    				request.done(function (response, textStatus, jqXHR){
    					//update list of indexes everywhere on the page
    	    	    	getIndexes();
    	    			//remove old info messages
    	    	        resetDisplay();
    					//display info msg for delete index  
    					$('#deletemsg').text(response);    			
   					 });
}		
 
    
	var deleteAllBtn=document.getElementById('deleteAll');
    	deleteAllBtn.onclick=function(evt){    
        	console.log("========Inside deleteAllBtn onclick function");
    		var request=jsRoutes.controllers.Admin.deleteAllIndexes().ajax({
   				type:'DELETE'
    		});
    		
    		request.done(function (response, textStatus, jqXHR){
    			//update list of indexes everywhere on the page
    	    	getIndexes();
    			//remove old info messages
    	        resetDisplay();
    			//display info msg for delete all indexes
    			$('#deleteallmsg').text(response);			
           });
	}	
    
   /*
    *Called when list of indexes changed  - created or deleted an index, or deleted all.
    */
    function resetDisplay(){
    	console.log("===top of resetDisplay");
    	//hide the table with all indexes
    	document.getElementById('listIndexesTable').innerHTML="";
    	//hide old info messages (create, build, delete, deleteAll)
    	document.getElementById("createIndexFeedback").innerHTML = "";
    	$('#buildmsg').text("");
    	$('#deletemsg').text("");
    	$('#deleteallmsg').text("");	
    }
    
   
</script>
}
