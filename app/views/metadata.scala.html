@(dataset: models.Dataset, metadata: Map[String,Any], userMetadata: scala.collection.mutable.Map[String,Any], xmlMetadata: List[models.DatasetXMLMetadata], rdfExported: Boolean)(implicit user: Option[securesocial.core.Identity])

@import com.mongodb.casbah.Imports.DBObject
@import collection.JavaConverters._

<form class="form-inline">	
	@printLevel(metadata: scala.collection.immutable.Map[String,Any]) = {
		<ul>
		@for((key,value) <- metadata) {
			<li><b>@(key):</b>
			@if(value.isInstanceOf[String]) {
				@if(value.asInstanceOf[String].startsWith("http://") || value.asInstanceOf[String].startsWith("https://")) {
					<a href="@value">@value</a>
				} else {
					@value
				}
			} else {
			    @printLevel(value.asInstanceOf[DBObject].toMap.asScala.toMap.asInstanceOf[scala.collection.immutable.Map[String, Any]])
			}</li>
		}
		</ul>
	} 
	@printLevelUserMetadata(metadata: scala.collection.mutable.Map[String,Any]) = {
		<ul class="usr_md_">
		@for((key,value) <- metadata) {

			@if(value.isInstanceOf[com.mongodb.BasicDBList]){
				@for(listValue <- value.asInstanceOf[com.mongodb.BasicDBList]) {


						<li class="usr_md_"><b class="usr_md_">@(key):</b>
						@if(listValue.isInstanceOf[String]) {			
							<span class="usr_md_">@listValue</span><button class="usr_md_" type="button">Modify</button><button class="usr_md_" >Delete</button>
						} else {
								<button class="usr_md_" type="button">Add property</button><button class="usr_md_" type="button">Delete</button>@printLevelUserMetadata(listValue.asInstanceOf[DBObject].toMap.asScala.asInstanceOf[scala.collection.mutable.Map[String, Any]])
						}</li>

				}
			}else{
				<li class="usr_md_"><b class="usr_md_">@(key):</b>
				@if(value.isInstanceOf[String]) {			
					<span class="usr_md_">@value</span><button class="usr_md_" type="button">Modify</button><button class="usr_md_" >Delete</button>
				} else {
						<button class="usr_md_" type="button">Add property</button><button class="usr_md_" type="button">Delete</button>@printLevelUserMetadata(value.asInstanceOf[DBObject].toMap.asScala.asInstanceOf[scala.collection.mutable.Map[String, Any]])
				}</li>
			}

		}
		</ul>
	}
	@*
		<h5>Auto-generated metadata:</h5>
		
		@if(metadata.isEmpty) {
			<div>No auto-generated metadata.</div>
		} else {
			<div>@printLevel(metadata)</div>
		}	
		<br />
	*@
	<h5>Community-generated metadata:</h5>
	
	<div id='generalUserMetadata_@(dataset.id.stringify)' class='usr_md_'>
		<button class="usr_md_" type="button">Add property</button>
		@printLevelUserMetadata(userMetadata)
		<button class="usr_md_submit btn" type="button">Submit</button>
		@if(rdfExported){
			<button class="usr_md_submit btn rdfbtn" type="button">Get as RDF</button>
		}
	</div>

			
</form>
<script language="javascript">
	var topId = "generalUserMetadata_@(dataset.id.stringify)"; 
	window["uploadIp"+topId] = "@api.routes.Datasets.addUserMetadata(dataset.id)";
	window["rdfIp"+topId] = "@api.routes.Datasets.getRDFUserMetadata(dataset.id)";
	window["modelIp"+topId] = "@(routes.Assets.at("datasetsUserMetadataModel"))";
</script>
<script src="@routes.Assets.at("javascripts/userMetadata.js")" type="text/javascript"></script>
@if(!user.isDefined) {
   <script language="javascript">
		$("#generalUserMetadata_@(dataset.id.stringify) button").css("display","none");
		$("#generalUserMetadata_@(dataset.id.stringify) .rdfbtn").css("display","inline");
   </script>
}
@if(user.isDefined) {
	@if(!user.get.identityId.userId.equals(dataset.author.identityId.userId)){
			<script language="javascript">
				$("#generalUserMetadata_@(dataset.id.stringify) button").css("display","none");
				$("#generalUserMetadata_@(dataset.id.stringify) .rdfbtn").css("display","inline");
		   </script>
	}
}
