@(curationObject: models.CurationObject, m: List[models.Metadata], rdfExported: Boolean, files :List[CurationFile] )(implicit user: Option[models.User])
@import api.Permission
@import helper._
@import collection.JavaConverters._
@import play.api.Play.current
@implicitFieldConstructor = @{ FieldConstructor(twitterBootstrapInput.f) }

@main(curationObject.name) {
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-body">
                    <a href="@routes.Spaces.stagingArea(curationObject.space)"> Staging Area</a> >
                    <u><strong>Edit Metadata</strong></u> >
                    <a  href="@routes.CurationObjects.findMatchingRepositories(curationObject.id)">Select Repository</a> >
                    Submit to Repository
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-2">
            <a class="btn btn-default" href="@routes.Spaces.stagingArea(curationObject.space)"><span class="glyphicon glyphicon-chevron-left"></span>Staging Area</a>
        </div>
        <div class="col-md-8 text-center">
            <h1>Edit Metadata</h1>
        </div>
        <div class="col-md-2">
            <a class="btn btn-primary pull-right" href="@routes.CurationObjects.findMatchingRepositories(curationObject.id)"> Select Repository <span class="glyphicon glyphicon-chevron-right"></span></a>
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            @spaces.curation_summary( curationObject, curationObject.name, true)
        </div>
        <div class="col-md-9">
        <div>
            <div>Note: The links in this page redirect to the live objects.</div>
            @if(Permission.checkPermission(Permission.AddMetadata, ResourceRef(ResourceRef.curationObject, curationObject.id))) {
                 <div class="row">
                    <div class="col-md-12">
                    @metadatald.addMetadata("curationObject", curationObject.id.toString, "metadata-content-ds")
                    </div>
                 </div>
            }
            <div class="row">
                <div class="col-md-12" id="metadata-content-ds">
                @metadatald.view(m.filter(_.attachedTo.resourceType == ResourceRef.curationObject))
                </div>
            </div>
        </div>



        @if(files.size > 0 ){
            <h2> Files</h2>
        }

        <div>
            <ul style = "list-style-type: none">
            @for(file<- files) {

                <li>
                    <h3><a href=@routes.Files.file(file.fileId)>@file.filename</a>
                    @if(Permission.checkPermission(Permission.EditStagingArea, ResourceRef(ResourceRef.curationObject, curationObject.id))) {
                        <a id="@file.id" title="Delete curation file" class="btn btn-link delete-file">
                            <span class="glyphicon glyphicon-trash"></span>
                        </a>
                    }
                    </h3>
                    <div id ='allMetadata_@(file.id)'>
                        <button class="btn btn-link" type="button">Show File metadata</button>
                        <div style="display:none;">
                            <div class="row border-top">
                                <div class="col-md-12">
                                @if(Permission.checkPermission(Permission.AddMetadata, ResourceRef(ResourceRef.curationObject, curationObject.id))) {
                                    <div class="row">
                                        <div class="col-md-12">
                                            @metadatald.addMetadata("curationFile", file.id.toString, "metadata-content-"+file.id.stringify)
                                        </div>
                                    </div>
                                }
                                <div class="row">
                                    <div class="col-md-12" id="metadata-content-@file.id.stringify">
                                        @metadatald.view(m.filter(_.attachedTo.id == file.id))
                                    </div>
                                </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </li>

                <script>
                    $("#allMetadata_@(file.id.toString) > button").on('click', function(){
                        if($("#allMetadata_@(file.id.toString) > div").attr('style') == 'display:none;'){
                            $("#allMetadata_@(file.id.toString) > div").attr('style', 'display:block;');
                            $("#allMetadata_@(file.id.toString) > button").get(0).innerHTML = "Hide file metadata";
                        }
                        else{
                            $("#allMetadata_@(file.id.toString) > div").attr('style', 'display:none;');
                            $("#allMetadata_@(file.id.toString) > button").get(0).innerHTML = "Show file metadata";
                        }
                    });

                   $('.delete-file').unbind().on('click', function(){
                        var delete_file = $(this);
                        var request = jsRoutes.api.CurationObjects.deleteCurationFiles('@curationObject.id', this.id).ajax({
                            type: 'DELETE'
                        });

                        request.done(function (response, textStatus, jqXHR) {
                            console.log("success");
                            delete_file.closest("LI").remove();
                        });

                        request.fail(function (jqXHR, textStatus, errorThrown){
                            console.error("The following error occured: " + textStatus, errorThrown);
                            var errMsg = "You must be logged in to add metadata";
                            if (!checkErrorAndRedirect(jqXHR, errMsg)) {
                              notify("Curation file was not removed due to : " + errorThrown, "error");
                            }
                        });
                     });
                </script>
            }
            </ul>
        </div>
        </div>
        </div>
    <div class="row bottom-padding">
        <div class="col-md-12">
            <a class="btn btn-default" href="@routes.Spaces.stagingArea(curationObject.space)"><span class="glyphicon glyphicon-chevron-left"></span>Staging Area</a>
            <a class="btn btn-primary pull-right" href="@routes.CurationObjects.findMatchingRepositories(curationObject.id)">Select Repository <span class="glyphicon glyphicon-chevron-right"></span></a>
        </div>
    </div>


}