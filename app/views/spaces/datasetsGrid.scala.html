@(datasets: List[Dataset], space: String)(implicit user: Option[models.User])

@import _root_.util.Formatters.ellipsize
@import api.Permission

@util.masonry()

<p>
    Most recent datasets:
    <span class="pull-right">
        @if(user.isDefined &&  Permission.checkPermission(Permission.EditSpace, ResourceRef(ResourceRef.space, UUID(space)))) {
            <a id ="create-dataset" href="@routes.Datasets.newDataset(Some(space))" class="btn btn-primary btn-xs">

                Create Dataset
            </a>
        }
        <a href="@(routes.Datasets.list("", "", 12, Some(space)))" class="btn btn-default btn-xs">
            <span class="glyphicon glyphicon-hand-right"></span>
            All Datasets
        </a>
    </span>

</p>

<div class="row" id="tile-view">
    <div class="col-md-12">
        <div id="masonry">
        @datasets.map { dataset =>
            <div class="post-box col-lg-4 col-md-4 col-sm-4">
                <div class="panel panel-default">
                    <div class="pull-right">
                        <a href="#" title="Bookmark" class="pull-right bookmark-link"><span class="glyphicon glyphicon-bookmark bookmark"></span></a>
                    </div>
                    <div class="panel-body">
                        @if(!dataset.thumbnail_id.isEmpty){
                            <a href="@(routes.Datasets.dataset(dataset.id))">
                                <img class="img-responsive" src="@(routes.Files.thumbnail(UUID(dataset.thumbnail_id.toString().substring(5,dataset.thumbnail_id.toString().length-1))))" alt="Thumbnail of @(dataset.name)">
                            </a>
                        }
                    <div class="caption break-word">
                        <h4><a href="@(routes.Datasets.dataset(dataset.id, Some(space)))">@dataset.name</a></h4>
                        <p>@ellipsize(dataset.description, 200)</p>
                    </div>
                    </div>
                        <!-- Dataset Info -->
                    <ul class="list-group">
                        <li class="list-group-item">
                            <span class="glyphicon glyphicon glyphicon-file" title="@dataset.files.size files"></span> @dataset.files.size
                            <span class="glyphicon glyphicon glyphicon-tags" title="@dataset.tags.size tags"></span> @dataset.tags.size
                            <span class="glyphicon glyphicon glyphicon-list" title="@(dataset.metadataCount) metadata fields"></span> @(dataset.metadataCount)
                            @if(play.api.Play.current.plugin[services.StagingAreaPlugin].isDefined && Permission.checkPermission(Permission.EditStagingArea, ResourceRef(ResourceRef.space, UUID(space)))) {
                                <a href="@(routes.CurationObjects.newCO(dataset.id, space))">
                                    <button class="btn btn-default btn-xs">
                                        Publish
                                    </button>
                                </a>
                            }
                        </li>
                    </ul>
                </div>
            </div>
        }
        </div>
    </div>
</div>

@if(!user.isDefined) {
    <script type="text/javascript">
        $('#create-dataset').addClass('disabled');
    </script>
}